<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <title>Product Details</title>
</head>

<body>
    <h1>{{ product.product_name }}</h1>
    <h3>Brand: {{ product.brands }}</h3>
    <h5>Quantity: {{ product.quantity }}</h5>
    <h5>Categories: {{ product.categories }}</h5>
    <h5>Nutrients:</h5>
    <ul>
        <li>Protein per 100g: {{ product.protein_per_100g }}</li>
        <li>Carbs per 100g: {{ product.carbs_per_100g }}</li>
        <li>Fats per 100g: {{ product.fats_per_100g }}</li>
        <li>Kcal per 100g: {{ product.kcal_per_100g }}</li>
    </ul>
    {% if common_allergies %}
    <h5>Common Allergies:</h5>
    <ul>
        {% for allergy in common_allergies %}
            <li class="allergy-message">{{ allergy }}</li>
        {% endfor %}
    </ul>
    <p>You cannot add this product to your basket due to common allergies.</p>
    {% else %}
    <form method="post" action="{% url 'add_to_basket' product.id source %}">
        {% csrf_token %}
        <input type="submit" value="Add to Basket">
    </form>
    {% endif %}
    {% if common_allergies|length == 1 %}
    <p>There is {{ common_allergies|length }} common allergy.</p>
    {% elif common_allergies|length > 1 %}
    <p>There are {{ common_allergies|length }} common allergies.</p>
    {% else %}
    <p>No common allergies found.</p>
    {% endif %}
    {% if product_rating %}
    <h5>Product Rating: {{ product_rating }}</h5>
    {% else %}
    <p>No rating available for this product.</p>
    {% endif %}
    {% if product.id %}
        <form method="post" action="{% if product.source == 'database' %}{% url 'rate_product' product.id 'database' %}{% else %}{% url 'rate_product' product.id 'api' %}{% endif %}">
            {% csrf_token %}
            <label for="rating">Rating:</label>
            <input type="number" name="rating" min="0" max="5" step="0.1" required>
            <button type="submit" class="btn btn-primary">Submit Rating</button>
        </form>
    {% endif %}
</body>

</html>
